"use strict";(self["webpackChunkshop_project"]=self["webpackChunkshop_project"]||[]).push([[24],{4024:function(t,e,s){s.r(e),s.d(e,{default:function(){return c}});var i=function(){var t=this,e=t._self._c;return e("div",[e("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[e("el-breadcrumb-item",{attrs:{to:{path:"/home"}}},[t._v("首页")]),e("el-breadcrumb-item",[t._v("权限管理")]),e("el-breadcrumb-item",[t._v("角色列表")])],1),e("el-card",[e("el-button",{attrs:{type:"primary"}},[t._v("添加角色")]),e("el-table",{attrs:{data:t.roleslist,border:"",stripe:""}},[e("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(s){return t._l(s.row.children,(function(i,r){return e("el-row",{key:i.id,class:["bd_bottom",0===r?"bd_top":"","view_center"]},[e("el-col",{attrs:{span:5}},[e("el-tag",{attrs:{closable:""},on:{close:function(e){return t.removeRole(s.row,i.id)}}},[t._v(t._s(i.authName))]),e("i",{staticClass:"el-icon-caret-right"})],1),e("el-col",{attrs:{span:19}},t._l(i.children,(function(i,r){return e("el-row",{key:i.id,class:[0===r?"":"bd_top","view_center"]},[e("el-col",{attrs:{span:6}},[e("el-tag",{attrs:{closable:"",type:"success"},on:{close:function(e){return t.removeRole(s.row,i.id)}}},[t._v(t._s(i.authName))]),e("i",{staticClass:"el-icon-caret-right"})],1),e("el-col",{attrs:{span:18}},t._l(i.children,(function(i){return e("el-tag",{key:i.id,attrs:{closable:"",type:"warning"},on:{close:function(e){return t.removeRole(s.row,i.id)}}},[t._v(t._s(i.authName))])})),1)],1)})),1)],1)}))}}])}),e("el-table-column",{attrs:{label:"#",type:"index"}}),e("el-table-column",{attrs:{label:"角色名称",prop:"roleName"}}),e("el-table-column",{attrs:{label:"角色描述",prop:"roleDesc"}}),e("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-button",{attrs:{type:"primary",icon:"el-icon-edit",size:"mini"}},[t._v("编辑")]),e("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini"}},[t._v("删除")]),e("el-button",{attrs:{type:"warning",icon:"el-icon-setting",size:"mini"},on:{click:function(e){return t.showSettingDialog(s.row)}}},[t._v("分配权限")])]}}])})],1)],1),e("el-dialog",{attrs:{title:"分配权限",visible:t.settingDialogVisible,width:"50%"},on:{"update:visible":function(e){t.settingDialogVisible=e},close:t.settingDialogClosed}},[e("el-tree",{ref:"treeRef",attrs:{data:t.rightsList,props:t.treeProps,"node-key":"id","show-checkbox":"","default-expand-all":"","default-checked-keys":t.defKeys}}),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.settingDialogVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.allotRights}},[t._v("确 定")])],1)],1)],1)},r=[],a=(s(7658),{data(){return{roleslist:[],settingDialogVisible:!1,rightsList:[],treeProps:{children:"children",label:"authName"},defKeys:[],roleId:""}},created(){this.getRolesList()},methods:{async getRolesList(){const{data:t}=await this.$http.get("roles");if(200!==t.meta.status)return this.$message.error("获取角色列表失败！");this.roleslist=t.data},async removeRole(t,e){const{data:s}=await this.$http.delete(`roles/${t.id}/rights/${e}`);if(200!==s.meta.status)return this.$message.error("删除权限失败！");this.$message.success("删除权限成功！"),t.children=s.data},async showSettingDialog(t){const{data:e}=await this.$http.get("rights/tree");if(200!==e.meta.status)return this.$message.error("获取权限列表失败！");this.rightsList=e.data,this.getLeafKeys(t,this.defKeys),this.settingDialogVisible=!0,this.roleId=t.id},getLeafKeys(t,e){if(!t.children)return e.push(t.id);t.children.forEach((t=>{this.getLeafKeys(t,e)}))},settingDialogClosed(){this.defKeys=[]},async allotRights(){const t=[...this.$refs.treeRef.getCheckedKeys(),...this.$refs.treeRef.getHalfCheckedKeys()],e=t.join(","),{data:s}=await this.$http.post(`roles/${this.roleId}/rights`,{rids:e});if(200!==s.meta.status)return this.$message.error("更新权限失败！");this.$message.success("更新权限成功！"),this.getRolesList(),this.settingDialogVisible=!1}}}),l=a,o=s(1001),n=(0,o.Z)(l,i,r,!1,null,"487d7108",null),c=n.exports}}]);
//# sourceMappingURL=24.759985d8.js.map